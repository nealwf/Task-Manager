<!DOCTYPE html>
<html>

<head>
    <link href="taskmanager.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript">

        function addTask(type) {
            console.log('added!');
            console.log(type);

            var dialog = document.querySelector("dialog");
            var title = dialog.querySelector("#title-input");
            var diff = dialog.querySelector('input[name="difficulty"]');
            var btn = dialog.querySelector("button");

            diff.addEventListener("change", (e) => {
                btn.value += "d:" + diff.value + ",";
            });

            title.addEventListener("change", (e) => {
                btn.value += "t:" + title.value + ",";
            });

            btn.addEventListener("click", (event) => {
                event.preventDefault(); // We don't want to submit this fake form
                dialog.close(btn.value); // Have to send the select box value here.
            });

            dialog.addEventListener("close", (e) => {

                var values = dialog.returnValue.split(',');
                var newTitle;
                var diffValue;
                var newDiff;

                for (const value of values) {
                    if (value.startsWith('d:')) {
                        diffValue = value.substring(2);
                    } else if (value.startsWith('t:')) {
                        newTitle = value.substring(2);
                    }
                }

                console.log(diffValue);

                for (var i = 0; i < diffValue; i++) {
                    newDiff += "★";
                }

                var taskListId = "#" + type + "-list";
                var newTask = document.createElement('li');

                newTask.innerHTML = `<button type="button">0</button><span class="task-title">` + newTitle + `</span><span class="difficulty flex-right">` + newDiff + `</span>`;

                var taskList = document.querySelector(taskListId);

                taskList.append(newTask);

                title.value = "";
                diff.value = "";
                btn.value = "";
            });


            dialog.showModal();



        }


        window.onload = (event) => {

            var addButtons = document.querySelectorAll('.add-task-button');


            var addButtons = document.querySelectorAll('.add-task-button');



            addButtons.forEach((button) => {
                button.addEventListener('click', function (event) {
                    addTask(this.id);

                })
            });
        }

        //dialog.showModal();

        function increment(element) {
            var value = element.innerHTML;
            value++;
            element.innerHTML = value;
        }



    </script>

    <title>Task Manager</title>
</head>

<body>
    <header>
        <img src="placeholder.png" id="avatar" />
        <div id="stats">
            <p id="level">Level 2</p>
            <span id="clips"><img alt="clip" src="clip.png" id="clip-icon" />
                <p>100</p>
            </span>
            <label id="xp">
                XP <progress id="xp-bar" max="100" value="20"></progress>
            </label>
        </div>
        <nav>
            <ul>
                <li><a href="tasks.html">Tasks</a></li>
                <li><a href="projects.html">Projects</a></li>
                <li><a href="wardrobe.html">Wardrobe</a></li>
                <li><a href="shops.html">Shops</a></li>
                <li><a href="stats.html">Stats</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <dialog>
            <p>Add a task</p>
            <form>
                <label>Title: <input type="text" id="title-input" placeholder="New task" /></label>
                <fieldset>
                    <legend>Difficulty</legend>

                    <div class="flex-row">
                        <label for="easy">Easy
                            <input type="radio" id="easy" name="difficulty" value="1" />
                        </label>
                        <label for="medium">Medium
                            <input type="radio" id="medium" name="difficulty" value="2" />
                        </label>
                        <label for="hard">Hard
                            <input type="radio" id="hard" name="difficulty" value="3" />
                        </label>
                    </div>
                </fieldset>
                <button type="submit">Add task</button>
            </form>
        </dialog>
        <div id="list-1" class="task-list">
            <div class="task-list-header flex-center">
                <h2>Pertinents</h2>
                <button id="pertinent" class="add-task-button" type="button">+</button>
            </div>
            <ul id="pertinent-list">
                <li><button type="button">2</button><span class="task-title">task 1</span><span class="difficulty">★</span></li>
                <li><button type="button">0</button><span class="task-title">task 2</span><span class="difficulty flex-right">★★★</span></li>
            </ul>
        </div>
        <div id="list-2" class="task-list">
            <div class="task-list-header flex-center">
                <h2>Predictables</h2>
                <button id="predictable" class="add-task-button" type="button">+</button>
            </div>
            <ul id="predictable-list">
                <li>task</li>
                <li>task</li>
            </ul>
        </div>
        <div id="list-3" class="task-list">
            <div class="task-list-header flex-center">
                <h2>To Do</h2>
                <button id="todo" class="add-task-button" type="button">+</button>
            </div>
            <ul id="todo-list">
                <li>task</li>
                <li>task</li>
            </ul>
        </div>
        <div id="list-4" class="task-list">
            <div class="task-list-header flex-center">
                <h2>Don't Forget</h2>
                <button id="forget" class="add-task-button" type="button">+</button>
            </div>
            <ul id="forget-list">
                <li>task</li>
                <li>task</li>
            </ul>
        </div>
    </main>
    <footer>
        <p>A project by Neal Whitefur &bull; [license] &bull; Help</p>
        <p id="info"></p>
    </footer>
</body>


</html>